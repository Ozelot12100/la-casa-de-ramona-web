---
import { Menu } from "lucide-react";

interface Props {
    lang?: "en" | "es";
}

const { lang = "en" } = Astro.props;

// Diccionario de Traducciones
const t = {
    en: {
        house: "The House",
        gallery: "Gallery", // Nuevo elemento
        amenities: "Amenities",
        reviews: "Reviews",
        location: "Location",
        book: "Book Direct",
        switchLabel: "ES",
        switchFlag: "拆",
        switchLink: "/es",
    },
    es: {
        house: "La Casa",
        gallery: "Galer铆a", // Nuevo elemento
        amenities: "Amenidades",
        reviews: "Rese帽as",
        location: "Ubicaci贸n",
        book: "Reservar",
        switchLabel: "EN",
        switchFlag: "吼",
        switchLink: "/",
    },
};
const text = t[lang];
---

<nav
    id="navbar"
    class="fixed w-full z-50 bg-white/95 backdrop-blur-md border-b border-slate-100 shadow-sm transition-all h-20"
>
    <div
        class="max-w-7xl mx-auto px-6 h-full flex items-center justify-between"
    >
        <a
            href={lang === "en" ? "/" : "/es"}
            class="flex items-center gap-2 group"
        >
            <div
                class="text-2xl font-bold text-blue-900 tracking-tight group-hover:text-blue-700 transition"
            >
                LA CASA DE RAMONA
            </div>
        </a>

        <div
            class="hidden md:flex items-center gap-6 lg:gap-8 font-medium text-slate-600 text-sm uppercase tracking-wide"
        >
            <a
                href="#house"
                class="nav-link hover:text-blue-600 transition border-b-2 border-transparent py-1"
            >
                {text.house}
            </a>

            <a
                href="#gallery"
                class="nav-link hover:text-blue-600 transition border-b-2 border-transparent py-1"
            >
                {text.gallery}
            </a>

            <a
                href="#amenities"
                class="nav-link hover:text-blue-600 transition border-b-2 border-transparent py-1"
            >
                {text.amenities}
            </a>

            <a
                href="#reviews"
                class="nav-link hover:text-blue-600 transition border-b-2 border-transparent py-1"
            >
                {text.reviews}
            </a>

            <a
                href="#location"
                class="nav-link hover:text-blue-600 transition border-b-2 border-transparent py-1"
            >
                {text.location}
            </a>

            <a
                href={text.switchLink}
                class="flex items-center gap-2 text-slate-600 hover:text-blue-900 transition border border-slate-200 rounded-full px-3 py-1.5 hover:bg-slate-50 ml-2"
            >
                <span class="text-lg leading-none">{text.switchFlag}</span>
                <span class="font-bold text-xs">{text.switchLabel}</span>
            </a>

            <a
                href="#contact"
                class="bg-blue-900 text-white px-6 py-2.5 rounded-full font-bold text-sm hover:bg-blue-800 transition shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
            >
                {text.book}
            </a>
        </div>

        <div class="md:hidden text-slate-600 flex items-center gap-4">
            <a
                href={text.switchLink}
                class="flex items-center gap-1 font-bold text-sm text-slate-500 border border-slate-200 px-3 py-1 rounded-full"
            >
                <span>{text.switchFlag}</span>
                <span>{text.switchLabel}</span>
            </a>
            <Menu size={28} />
        </div>
    </div>
</nav>

<script>
    /**
     * SCROLL SPY (Marcador de Secci贸n Activa)
     * Detecta qu茅 secci贸n est谩 visible y marca el enlace correspondiente.
     */

    // Seleccionamos todas las secciones que tienen ID y que coinciden con nuestros enlaces
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(".nav-link");

    const observerOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.25, // Se activa cuando el 25% de la secci贸n es visible
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                // 1. Resetear estilos
                navLinks.forEach((link) => {
                    link.classList.remove(
                        "text-blue-900",
                        "font-bold",
                        "border-blue-900",
                    );
                    link.classList.add("text-slate-600", "border-transparent");
                });

                // 2. Activar el enlace correcto
                const activeId = entry.target.getAttribute("id");
                const activeLink = document.querySelector(
                    `.nav-link[href="#${activeId}"]`,
                );

                if (activeLink) {
                    activeLink.classList.remove(
                        "text-slate-600",
                        "border-transparent",
                    );
                    activeLink.classList.add(
                        "text-blue-900",
                        "font-bold",
                        "border-blue-900",
                    );
                }
            }
        });
    }, observerOptions);

    sections.forEach((section) => {
        observer.observe(section);
    });
</script>
